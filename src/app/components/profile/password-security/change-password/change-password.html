<div class="page-header">
  <a routerLink="/profile" class="back-button">
    <i class="fa-solid fa-arrow-left"></i>
    <span>Voltar</span>
  </a>
  <h1>Senha e Segurança</h1>
  <p class="subtitle">Altere a sua senha e configure a segurança da sua conta.</p>
</div>

<div class="two-factor-section">
  <div>
    <h3>Autenticação de Dois Fatores (2FA)</h3>
    <p>Aumente a segurança da sua conta.</p>
  </div>
  <button mat-stroked-button (click)="openTwoFactorModal()">Ativar 2FA</button>
</div>


<div class="form-wrapper">
  @if (isLoading()) {
    <div class="spinner-container">
      <mat-spinner diameter="50"></mat-spinner>
    </div>
  } @else {
    <form [formGroup]="passwordForm" (ngSubmit)="onSubmit()" class="update-form">

      <mat-form-field appearance="outline" class="form-field">
        <mat-label>Senha Antiga</mat-label>
        <input matInput formControlName="oldPassword" [type]="hideOldPassword ? 'password' : 'text'">
        <button mat-icon-button matSuffix (click)="hideOldPassword = !hideOldPassword" type="button">
          <mat-icon>{{hideOldPassword ? 'visibility_off' : 'visibility'}}</mat-icon>
        </button>
      </mat-form-field>

      <mat-form-field appearance="outline" class="form-field">
        <mat-label>Nova Senha</mat-label>
        <input matInput formControlName="newPassword" [type]="hideNewPassword ? 'password' : 'text'">
        <button mat-icon-button matSuffix (click)="hideNewPassword = !hideNewPassword" type="button">
          <mat-icon>{{hideNewPassword ? 'visibility_off' : 'visibility'}}</mat-icon>
        </button>
        @if (passwordForm.get('newPassword')?.hasError('minlength')) {
          <mat-hint>A senha deve ter no mínimo 6 caracteres.</mat-hint>
        }
      </mat-form-field>

      <mat-form-field appearance="outline" class="form-field">
        <mat-label>Confirmar Nova Senha</mat-label>
        <input matInput formControlName="confirmPassword" [type]="hideConfirmPassword ? 'password' : 'text'">
        <button mat-icon-button matSuffix (click)="hideConfirmPassword = !hideConfirmPassword" type="button">
          <mat-icon>{{hideConfirmPassword ? 'visibility_off' : 'visibility'}}</mat-icon>
        </button>
        @if (passwordForm.hasError('passwordMismatch') && passwordForm.get('confirmPassword')?.touched) {
          <mat-error>As senhas não coincidem.</mat-error>
        }
      </mat-form-field>

      <div class="actions">
        <button type="button" class="btn-stroked-warn" (click)="onCancel()">Cancelar</button>
        <button type="submit" class="btn-primary" [disabled]="passwordForm.invalid || isLoading()">
          Salvar Alterações
        </button>
      </div>

    </form>
  }
</div>
